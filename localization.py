### dÃ¹ng bcrypt vÃ  PostgreSQL 
import streamlit as st
from config import APP_TITLE_EN, APP_TITLE_VI
import logging

# Thiáº¿t láº­p logging
logger = logging.getLogger(__name__)
if not logger.handlers:
    handler = logging.StreamHandler()
    formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')
    handler.setFormatter(formatter)
    logger.addHandler(handler)

# Danh sÃ¡ch ngÃ´n ngá»¯ há»£p lá»‡
VALID_LANGUAGES = ["English", "Vietnamese"]

# VÄƒn báº£n Ä‘a ngÃ´n ngá»¯ (i18n)
TEXT = {
    "English": {
        "app_title": APP_TITLE_EN,
        "login": "ðŸ” Login",
        "username": "Username",
        "password": "Password",
        "login_button": "Login",
        "register": "ðŸ†• Register",
        "sec_question": "Security Question (for password reset)",
        "sec_answer": "Security Answer",
        "create_account": "Create Account",
        "reset_password": "â™»ï¸ Reset Password",
        "new_password": "New Password",
        "reset_button": "Reset Password",
        "logout": "Logout",
        "language": "Language",
        "title": "Title",
        "category": "Category",
        "instructions": "Instructions",
        "servings": "Servings",
        "name": "Name",
        "quantity": "Quantity",
        "unit": "Unit",
        "need": "Need",
        "have": "Have",
        "missing": "Missing",
        "inventory": "ðŸ“¦ Inventory",
        "your_stock": "Your Stock",
        "no_ingredients": "No ingredients yet.",
        "unit_tips": "Unit tips: use g, kg, ml, l, tsp, tbsp, cup, piece, pcs, láº¡ng, chÃ©n, bÃ¡t.",
        "add_ingredient": "Add New Ingredient",
        "recipes": "ðŸ“– Recipes",
        "your_recipes": "Your Recipes",
        "no_recipes": "No recipes yet.",
        "save_recipe": "Save Recipe",
        "update_recipe": "Update Recipe",
        "delete_recipe": "Delete Recipe",
        "feasibility": "âœ… Feasibility & Shopping",
        "create_recipes_first": "Create recipes first.",
        "you_can_cook": "Recipe Feasibility and Shopping List",
        "none_yet": "None yet.",
        "all_available": "All ingredients available.",
        "cook": "Cook",
        "missing_something": "Missing Ingredients",
        "all_feasible": "All recipes are feasible ðŸŽ‰",
        "add_to_shopping": "Add missing to Shopping List",
        "shopping_list": "ðŸ›’ Shopping List",
        "empty_list": "Your shopping list is empty.",
        "update_inventory": "Update Inventory from Shopping List",
        "purchased": "Inventory updated with purchased items.",
        "select_recipes_label": "Select recipes to proceed",
        "select_purchased": "Select purchased items",
        "sent_to_shopping": "Missing ingredients added to the shopping list.",
        "cook_success": "Cooked successfully.",
        "cook_failed": "Cooking failed.",
        "adjust_recipe": "âš–ï¸ Adjust Recipe",
        "select_recipe": "Select Recipe",
        "adjustment_type": "Adjustment Type",
        "by_servings": "By Servings",
        "by_main_ingredient": "By Main Ingredient",
        "new_servings": "New Servings",
        "main_ingredient": "Main Ingredient",
        "new_quantity": "New Quantity",
        "spice_level": "Spice Adjustment",
        "mild": "Mild (60%)",
        "normal": "Normal (80%)",
        "rich": "Rich (100%)",
        "adjusted_recipe": "Adjusted Recipe",
        "cook_adjusted": "Cook Adjusted Recipe",
        "add_to_shopping_adjusted": "Add Missing to Shopping List",
        "adjusted_recipe_title": "Adjusted: {title}",
        "no_recipe_selected": "Please select a recipe to adjust.",
        "invalid_adjustment": "Invalid adjustment parameters.",
        "cook_adjusted_success": "Adjusted recipe '{title}' cooked successfully.",
        "cook_adjusted_failed": "Failed to cook adjusted recipe '{title}'.",
        "not_logged_in": "You must be logged in to access this page.",
        "error_title_required": "Recipe title is required.",
        "error_ingredients_required": "At least one valid ingredient (with name and positive quantity) is required.",
        "duplicate_recipe": "A recipe with this title already exists.",
        "invalid_name": "Name must contain only letters, numbers, spaces, hyphens, underscores, or single quotes.",
        "food_timeline": "ðŸ² Food Timeline",
        "no_entries": "No entries found for the selected filters.",
        "stats_week": "This week, you cooked {count} dishes. Most frequent: {dish}.",
        "db_error": "Database error: {error}.",
        "remove_selected": "Remove Selected Ingredients",
        "search_placeholder": "Search (e.g., dish name, tag:signature, week:N, day:YYYY-MM-DD)",
        "reset_filter": "Reset Filter",
        "no_history": "No cooking history found.",
        "username_exists": "Username already exists."
    },
    "Vietnamese": {
        "app_title": APP_TITLE_VI,
        "login": "ðŸ” ÄÄƒng nháº­p",
        "username": "TÃªn ngÆ°á»i dÃ¹ng",
        "password": "Máº­t kháº©u",
        "login_button": "ÄÄƒng nháº­p",
        "register": "ðŸ†• ÄÄƒng kÃ½",
        "sec_question": "CÃ¢u há»i báº£o máº­t (Ä‘á»ƒ Ä‘áº·t láº¡i máº­t kháº©u)",
        "sec_answer": "CÃ¢u tráº£ lá»i báº£o máº­t",
        "create_account": "Táº¡o tÃ i khoáº£n",
        "reset_password": "â™»ï¸ Äáº·t láº¡i máº­t kháº©u",
        "new_password": "Máº­t kháº©u má»›i",
        "reset_button": "Äáº·t láº¡i máº­t kháº©u",
        "logout": "ÄÄƒng xuáº¥t",
        "language": "NgÃ´n ngá»¯",
        "title": "TiÃªu Ä‘á»",
        "category": "Danh má»¥c",
        "instructions": "HÆ°á»›ng dáº«n",
        "servings": "Kháº©u pháº§n",
        "name": "TÃªn",
        "quantity": "Sá»‘ lÆ°á»£ng",
        "unit": "ÄÆ¡n vá»‹",
        "need": "Cáº§n",
        "have": "CÃ³",
        "missing": "Thiáº¿u",
        "inventory": "ðŸ“¦ Kho hÃ ng",
        "your_stock": "Kho cá»§a báº¡n",
        "no_ingredients": "ChÆ°a cÃ³ nguyÃªn liá»‡u.",
        "unit_tips": "Máº¹o Ä‘Æ¡n vá»‹: sá»­ dá»¥ng g, kg, ml, l, tsp, tbsp, cup, piece, cÃ¡i, pcs, láº¡ng, chÃ©n, bÃ¡t.",
        "add_ingredient": "ThÃªm nguyÃªn liá»‡u má»›i",
        "recipes": "ðŸ“– CÃ´ng thá»©c",
        "your_recipes": "CÃ´ng thá»©c cá»§a báº¡n",
        "no_recipes": "ChÆ°a cÃ³ cÃ´ng thá»©c nÃ o.",
        "save_recipe": "LÆ°u cÃ´ng thá»©c",
        "update_recipe": "Cáº­p nháº­t cÃ´ng thá»©c",
        "delete_recipe": "XÃ³a cÃ´ng thá»©c",
        "feasibility": "âœ… TÃ­nh kháº£ thi & Mua sáº¯m",
        "create_recipes_first": "HÃ£y táº¡o cÃ´ng thá»©c trÆ°á»›c.",
        "you_can_cook": "TÃ­nh kháº£ thi cÃ´ng thá»©c vÃ  Danh sÃ¡ch mua sáº¯m",
        "none_yet": "ChÆ°a cÃ³.",
        "all_available": "Táº¥t cáº£ nguyÃªn liá»‡u cÃ³ sáºµn.",
        "cook": "Náº¥u",
        "missing_something": "Thiáº¿u nguyÃªn liá»‡u",
        "all_feasible": "Táº¥t cáº£ cÃ´ng thá»©c Ä‘á»u kháº£ thi ðŸŽ‰",
        "add_to_shopping": "ThÃªm thiáº¿u vÃ o Danh sÃ¡ch mua sáº¯m",
        "shopping_list": "ðŸ›’ Danh sÃ¡ch mua sáº¯m",
        "empty_list": "Danh sÃ¡ch mua sáº¯m cá»§a báº¡n trá»‘ng.",
        "update_inventory": "Cáº­p nháº­t kho tá»« Danh sÃ¡ch mua sáº¯m",
        "purchased": "Kho Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t vá»›i cÃ¡c máº·t hÃ ng Ä‘Ã£ mua.",
        "select_recipes_label": "Chá»n cÃ´ng thá»©c Ä‘á»ƒ tiáº¿p tá»¥c",
        "select_purchased": "Chá»n cÃ¡c máº·t hÃ ng Ä‘Ã£ mua",
        "sent_to_shopping": "NguyÃªn liá»‡u thiáº¿u Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o danh sÃ¡ch mua sáº¯m.",
        "cook_success": "Náº¥u thÃ nh cÃ´ng.",
        "cook_failed": "Náº¥u tháº¥t báº¡i.",
        "adjust_recipe": "âš–ï¸ Äiá»u chá»‰nh CÃ´ng thá»©c",
        "select_recipe": "Chá»n CÃ´ng thá»©c",
        "adjustment_type": "Loáº¡i Äiá»u chá»‰nh",
        "by_servings": "Theo Kháº©u pháº§n",
        "by_main_ingredient": "Theo NguyÃªn liá»‡u ChÃ­nh",
        "new_servings": "Kháº©u pháº§n Má»›i",
        "main_ingredient": "NguyÃªn liá»‡u ChÃ­nh",
        "new_quantity": "Sá»‘ lÆ°á»£ng Má»›i",
        "spice_level": "Äiá»u chá»‰nh Gia vá»‹",
        "mild": "Nháº¡t (60%)",
        "normal": "BÃ¬nh thÆ°á»ng (80%)",
        "rich": "Äáº­m (100%)",
        "adjusted_recipe": "CÃ´ng thá»©c ÄÃ£ Äiá»u chá»‰nh",
        "cook_adjusted": "Náº¥u CÃ´ng thá»©c ÄÃ£ Äiá»u chá»‰nh",
        "add_to_shopping_adjusted": "ThÃªm Thiáº¿u vÃ o Danh sÃ¡ch Mua sáº¯m",
        "adjusted_recipe_title": "ÄÃ£ Ä‘iá»u chá»‰nh: {title}",
        "no_recipe_selected": "Vui lÃ²ng chá»n má»™t cÃ´ng thá»©c Ä‘á»ƒ Ä‘iá»u chá»‰nh.",
        "invalid_adjustment": "Tham sá»‘ Ä‘iá»u chá»‰nh khÃ´ng há»£p lá»‡.",
        "cook_adjusted_success": "CÃ´ng thá»©c Ä‘Ã£ Ä‘iá»u chá»‰nh '{title}' Ä‘Æ°á»£c náº¥u thÃ nh cÃ´ng.",
        "cook_adjusted_failed": "KhÃ´ng thá»ƒ náº¥u cÃ´ng thá»©c Ä‘Ã£ Ä‘iá»u chá»‰nh '{title}'.",
        "not_logged_in": "Báº¡n pháº£i Ä‘Äƒng nháº­p Ä‘á»ƒ truy cáº­p trang nÃ y.",
        "error_title_required": "TiÃªu Ä‘á» cÃ´ng thá»©c lÃ  báº¯t buá»™c.",
        "error_ingredients_required": "Cáº§n Ã­t nháº¥t má»™t nguyÃªn liá»‡u há»£p lá»‡ (cÃ³ tÃªn vÃ  sá»‘ lÆ°á»£ng dÆ°Æ¡ng).",
        "duplicate_recipe": "CÃ´ng thá»©c vá»›i tiÃªu Ä‘á» nÃ y Ä‘Ã£ tá»“n táº¡i.",
        "invalid_name": "TÃªn chá»‰ Ä‘Æ°á»£c chá»©a chá»¯ cÃ¡i, sá»‘, dáº¥u cÃ¡ch, dáº¥u gáº¡ch ngang, dáº¥u gáº¡ch dÆ°á»›i hoáº·c dáº¥u nhÃ¡y Ä‘Æ¡n.",
        "food_timeline": "ðŸ² DÃ²ng thá»i gian Thá»±c pháº©m",
        "no_entries": "KhÃ´ng tÃ¬m tháº¥y má»¥c nÃ o cho bá»™ lá»c Ä‘Ã£ chá»n.",
        "stats_week": "Tuáº§n nÃ y, báº¡n Ä‘Ã£ náº¥u {count} mÃ³n. MÃ³n thÆ°á»ng xuyÃªn nháº¥t: {dish}.",
        "db_error": "Lá»—i cÆ¡ sá»Ÿ dá»¯ liá»‡u: {error}.",
        "remove_selected": "XÃ³a CÃ¡c NguyÃªn liá»‡u ÄÃ£ Chá»n",
        "search_placeholder": "TÃ¬m kiáº¿m (vÃ­ dá»¥: tÃªn mÃ³n, tag:mÃ³n tá»§, tuáº§n:N, ngÃ y:YYYY-MM-DD)",
        "reset_filter": "Äáº·t láº¡i Bá»™ lá»c",
        "no_history": "KhÃ´ng tÃ¬m tháº¥y lá»‹ch sá»­ náº¥u Äƒn.",
        "username_exists": "TÃªn ngÆ°á»i dÃ¹ng Ä‘Ã£ tá»“n táº¡i."
    }
}

def get_text(key: str) -> str:
    """Retrieve localized text based on the current language.

    Args:
        key: The key for the text to retrieve.

    Returns:
        The localized text for the given key, or the key itself if not found.
    """
    language = st.session_state.get("language", "English")
    if language not in VALID_LANGUAGES:
        logger.warning(f"Invalid language '{language}', defaulting to English")
        language = "English"
    return TEXT.get(language, TEXT["English"]).get(key, key)